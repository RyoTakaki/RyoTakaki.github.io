<!DOCTYPE html>
<html>

<head>
    <title>Narrative Visualization</title>
    <!-- Ref: https://www.wabiapp.com/WabiSampleSource/html5/contents_change_disp_none.html -->
    <style>
        .page {
            display: none;
        }

        .active {
            display: block;
        }

        .axis text {
            font-size: 15px;
        }
    </style>
</head>

<body onload="init1(), init2(), init3()">

    <div class="page active" id="page1">
        <h1>Page 1</h1>
        <div>
            <button onclick="change_page(2)">Next</button>
        </div>
        <svg id="svg1"></svg>
        <script>
            async function init1() {
                // Reference: https://d3-graph-gallery.com/graph/barplot_horizontal.html
                // Reference: https://d3-graph-gallery.com/graph/interactivity_tooltip.html#template
                const data = await d3.csv("https://RyoTakaki.github.io/Learning_time.csv");
                console.log(data);
                var margin = { top: 50, right: 130, bottom: 80, left: 300 },
                    width = 1200 - margin.left - margin.right,
                    height = 800 - margin.top - margin.bottom;
                var xs = d3.scaleLinear().domain([0, 400]).range([0, width]);
                var ys = d3.scaleBand().domain(data.map(function (d) { return d.Course; })).range([0, height]).padding(.1);

                // create a tooltip
                var Tooltip = d3.select("#page1")
                    .append("div")
                    .style("opacity", 0)
                    .attr("class", "tooltip")
                    .style("background-color", "white")
                    .style("border", "solid")
                    .style("border-width", "1px")
                    .style("border-radius", "5px")
                    .style("padding", "5px")

                // Three function that change the tooltip when user hover / move / leave a cell
                var mouseover = function (d) {
                    Tooltip
                        .style("opacity", 1)
                    d3.select(this)
                        .style("stroke", "grey")
                        .style("opacity", 1)
                }
                var mousemove = function (d) {
                    Tooltip
                        .html("Total study hours: " + d.Total_hour + " [hour]")
                        .style("position", "absolute")
                        .style("left", (d3.mouse(this)[0] + margin.left) + "px")
                        .style("top", (d3.mouse(this)[1] + margin.top + 50) + "px")
                }
                var mouseleave = function (d) {
                    Tooltip
                        .style("opacity", 0)
                    d3.select(this)
                        .style("stroke", "none")
                        .style("opacity", 0.8)
                }

                // Features of the annotation
                const annotations_max = [
                    {
                        note: {
                            label: "Here is the annotation label",
                            title: "Max"
                        },
                        color: ["#69b3a2"],
                        x: 650,
                        y: 250,
                        dx: 100,
                        dy: 50
                    }
                ]

                // Features of the annotation
                const annotations_min = [
                    {
                        note: {
                            label: "Here is the annotation label",
                            title: "Min"
                        },
                        x: 650,
                        y: 450,
                        dx: 100,
                        dy: 50
                    }
                ]
                // Add annotation to the chart
                const makeAnnotations_max = d3.annotation()
                    .annotations(annotations_max)

                const makeAnnotations_min = d3.annotation()
                    .annotations(annotations_min)

                d3.select("#svg1")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .selectAll()
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("x", xs(0))
                    .attr("y", function (d) { return ys(d.Course); })
                    .attr("width", function (d) { return xs(d.Total_hour) })
                    .attr("height", ys.bandwidth())
                    .attr("fill", "lightblue")
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave);

                // Annotation
                d3.select("#svg1")
                    .append("g")
                    .call(makeAnnotations_max);

                // Annotation
                d3.select("#svg1")
                    .append("g")
                    .call(makeAnnotations_min);

                // Y axis
                d3.select("#svg1")
                    .append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .call(d3.axisLeft(ys));

                // X axis
                d3.select("#svg1")
                    .append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + margin.left + ", " + (height + margin.top) + ")")
                    .call(d3.axisBottom(xs));

                d3.select("#svg1")
                    .append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", margin.left + width / 2)
                    .attr("y", height + margin.top + 50)
                    .text("Total study hours per subject [hour]")
                    .style("font-family", "sans-serif")
                    .style("font-size", 20);
            }
        </script>
    </div>

    <div class="page" id="page2">
        <h1>Page 2</h1>
        <div>
            <button onclick="change_page(1)">Prev...</button>
            <button onclick="change_page(3)">Next</button>
        </div>
        <svg id="svg2"></svg>
        <script>
            async function init2() {
                // Reference: https://d3-graph-gallery.com/graph/line_filter.html
                const data = await d3.csv("https://flunky.github.io/cars2017.csv");
                console.log(data);
                var width = 800; var height = 500; var margin = 100;
                var xs = d3.scaleLog().domain([10, 150]).range([0, width]);
                var ys = d3.scaleLog().domain([10, 150]).range([height, 0]);
                d3.select("#svg2")
                    .attr("width", width + 2 * margin)
                    .attr("height", height + 2 * margin)
                    .append("g")
                    .attr("transform", "translate(" + margin + "," + margin + ")")
                    .selectAll()
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d, i) { return xs(d.AverageCityMPG) })
                    .attr("cy", function (d, i) { return ys(Number(d.AverageHighwayMPG)) })
                    .attr("r", function (d, i) { return 2 + Number(d.EngineCylinders) });
                d3.select("#svg2")
                    .append("g")
                    .attr("transform", "translate(" + margin + "," + margin + ")")
                    .call(d3.axisLeft(ys)
                        .tickValues([10, 20, 50, 100])
                        .tickFormat(d3.format("~s")));
                d3.select("#svg2")
                    .append("g")
                    .attr("transform", "translate(" + margin + "," + (height + margin) + ")")
                    .call(d3.axisBottom(xs)
                        .tickValues([10, 20, 50, 100])
                        .tickFormat(d3.format("~s")));
            }
        </script>
    </div>

    <div class="page" id="page3">
        <h1>Page 3</h1>
        <div>
            <button onclick="change_page(2)">Prev.</button>
            <!-- Initialize a select button -->
            <select id="selectButton"></select>
        </div>
        <svg id="svg3"></svg>
        <script>
            async function init3() {
                // Reference: https://d3-graph-gallery.com/graph/connectedscatter_legend.html
                // Reference: https://d3-graph-gallery.com/graph/line_filter.html
                const data = await d3.csv("https://RyoTakaki.github.io/Learning_time_week_time_per_course.csv");
                console.log(data);
                var margin = { top: 50, right: 130, bottom: 80, left: 300 },
                    width = 1200 - margin.left - margin.right,
                    height = 800 - margin.top - margin.bottom;

                var allGroup = ["CS410_TIS", "CS498_IoT", "CS598_DL4H", "CS412_IDM", "CS598_DMC", "CS598_PSL", "CS441_AML", "CS416_DV"]

                // add the options to the button
                d3.select("#selectButton")
                    .selectAll('myOptions')
                    .data(allGroup)
                    .enter()
                    .append('option')
                    .text(function (d) { return d; }) // text showed in the menu
                    .attr("value", function (d) { return d; }) // corresponding value returned by the button

                // A color scale: one color for each group
                var myColor = d3.scaleOrdinal()
                    .domain(allGroup)
                    .range(d3.schemeSet2);

                var xs = d3.scaleLinear().domain([0, 18]).range([0, width]);
                var ys = d3.scaleLinear().domain([0, 50]).range([height, 0]);

                var svg = d3.select("#svg3")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                var line = svg
                    .append("g")
                    .append("path")
                    .datum(data.filter(function (d) { return d.Course == allGroup[0] }))
                    .attr("d", d3.line()
                        .x(function (d) { return xs(+d.Week) })
                        .y(function (d) { return ys(+d.TimePerWeek) })
                    )
                    .attr("stroke", function (d) { return myColor("CS410_TIS") })
                    .style("stroke-width", 4)
                    .style("fill", "none");

                // Y axis
                svg.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(ys));

                // X axis
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(xs).ticks(18));

                svg.append("text", id = "xaxis")
                    .attr("text-anchor", "middle")
                    .attr("x", width / 2)
                    .attr("y", height + 50)
                    .text("Week")
                    .style("font-family", "sans-serif")
                    .style("font-size", 20);

                svg.append("text", id = "yaxis")
                    .attr("text-anchor", "middle")
                    .attr("x", -height / 2)
                    .attr("y", -40)
                    .attr("transform", "rotate(-90)")
                    .text("Total study hours per week [hour]")
                    .style("font-family", "sans-serif")
                    .style("font-size", 20);

                // A function that update the chart
                function update(selectedGroup) {

                    // Create new data with the selection?
                    var dataFilter = data.filter(function (d) { return d.Course == selectedGroup })

                    // Give these new data to update line
                    line
                        .datum(dataFilter)
                        .transition()
                        .duration(1000)
                        .attr("d", d3.line()
                            .x(function (d) { return xs(+d.Week) })
                            .y(function (d) { return ys(+d.TimePerWeek) })
                        )
                        .attr("stroke", function (d) { return myColor(selectedGroup) })
                }

                // When the button is changed, run the updateChart function
                d3.select("#selectButton").on("change", function (d) {
                    // recover the option that has been chosen
                    var selectedOption = d3.select(this).property("value")
                    // run the updateChart function with this selected option
                    update(selectedOption)

                })

            }
        </script>
    </div>

    <!-- Reference: https://d3-graph-gallery.com/graph/custom_annotation.html -->
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <!-- Load d3-annotation -->
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

    <script>

        function change_page(page_num) {
            // Hide all pages
            d3.selectAll(".page").classed("active", false);

            // Only show the selected page
            d3.select("#page" + page_num).classed("active", true);
        }
    </script>
</body>

</html>