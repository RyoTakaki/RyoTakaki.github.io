<!DOCTYPE html>
<html>

<head>
    <title>Narrative Visualization</title>
    <!-- Ref: https://www.wabiapp.com/WabiSampleSource/html5/contents_change_disp_none.html -->
    <style>
        .page {
            display: none;
        }

        .active {
            display: block;
        }

        .axis text {
            font-size: 15px;
        }
    </style>
</head>

<body onload="init1(), init2(), init3()">

    <div class="page active" id="page1">
        <h1>Page 1</h1>
        <div>
            <button onclick="change_page(2)">Next</button>
        </div>
        <svg id="svg1"></svg>
        <script>
            async function init1() {
                // Reference: https://d3-graph-gallery.com/graph/barplot_horizontal.html
                // Reference: https://d3-graph-gallery.com/graph/interactivity_tooltip.html#template
                const data = await d3.csv("https://RyoTakaki.github.io/Learning_time.csv");
                console.log(data);
                var margin = { top: 50, right: 50, bottom: 150, left: 200 },
                    width = 1200 - margin.left - margin.right,
                    height = 800 - margin.top - margin.bottom;
                var xs = d3.scaleBand().domain(data.map(function (d) { return d.Course; })).range([0, width]).padding(.1);
                var ys = d3.scaleLinear().domain([0, 400]).range([height, 0]);

                var allGroup = [
                    "CS410 Text Information Systems",
                    "CS498 Internet of Things",
                    "CS598 Deep Learning for Healthcare",
                    "CS412 Introduction to Data Mining",
                    "CS598 Data Mining Capstone",
                    "CS598 Practical Statistical Learning",
                    "CS441 Applied Machine Learning",
                    "CS416 Data Visualization"
                ]
                // create a tooltip
                var Tooltip = d3.select("#page1")
                    .append("div")
                    .style("opacity", 0)
                    .attr("class", "tooltip")
                    .style("background-color", "white")
                    .style("border", "solid")
                    .style("border-width", "1px")
                    .style("border-radius", "5px")
                    .style("padding", "5px")

                // Three function that change the tooltip when user hover / move / leave a cell
                var mouseover = function (d) {
                    Tooltip
                        .style("opacity", 1)
                    d3.select(this)
                        .style("stroke", "grey")
                        .style("opacity", 1)
                }
                var mousemove = function (d) {
                    Tooltip
                        .html("Total study hours: " + d.Total_hour + " [hour]")
                        .style("position", "absolute")
                        .style("left", (d3.mouse(this)[0] + margin.left) + "px")
                        .style("top", (d3.mouse(this)[1] + margin.top + 50) + "px")
                }
                var mouseleave = function (d) {
                    Tooltip
                        .style("opacity", 0)
                    d3.select(this)
                        .style("stroke", "none")
                        .style("opacity", 0.8)
                }

                // A color scale: one color for each group
                var myColor = d3.scaleOrdinal()
                    .domain(allGroup)
                    .range(d3.schemeSet2);

                // Features of the annotation
                const annotations_max = [
                    {
                        note: {
                            label: "Here is the annotation label",
                            title: "Max"
                        },
                        color: ["#69b3a2"],
                        x: 382,
                        y: 160,
                        dx: 50,
                        dy: -80
                    }
                ]

                // Features of the annotation
                const annotations_min = [
                    {
                        note: {
                            label: "Here is the annotation label",
                            title: "Min"
                        },
                        x: 968,
                        y: 600,
                        dx: 50,
                        dy: -80
                    }
                ]
                // Add annotation to the chart
                const makeAnnotations_max = d3.annotation()
                    .annotations(annotations_max)

                const makeAnnotations_min = d3.annotation()
                    .annotations(annotations_min)

                d3.select("#svg1")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .selectAll()
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("x", function (d) { return xs(d.Course); })
                    .attr("y", function (d) { return ys(d.Total_hour); })
                    .attr("height", function (d) { return height - ys(d.Total_hour) })
                    .attr("width", xs.bandwidth())
                    .attr("fill", function(d){ return myColor(d.Course) })
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave);

                // Annotation
                d3.select("#svg1")
                    .append("g")
                    .call(makeAnnotations_max);

                // Annotation
                d3.select("#svg1")
                    .append("g")
                    .call(makeAnnotations_min);

                // Y axis
                d3.select("#svg1")
                    .append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .call(d3.axisLeft(ys));

                // X axis
                d3.select("#svg1")
                    .append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + margin.left + ", " + (height + margin.top) + ")")
                    .call(d3.axisBottom(xs))
                    .selectAll("text")
                    .attr("transform", "translate(-10, 0)rotate(-30)")
                    .style("text-anchor", "end");

                d3.select("#svg1")
                    .append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", -margin.top - height/2)
                    .attr("y", margin.left - 50)
                    .attr("transform", "rotate(-90)")
                    .text("Total study hours per subject [hour]")
                    .style("font-family", "sans-serif")
                    .style("font-size", 20);
            }
        </script>
    </div>

    <div class="page" id="page2">
        <h1>Page 2</h1>
        <div>
            <button onclick="change_page(1)">Prev...</button>
            <button onclick="change_page(3)">Next</button>
        </div>
        <svg id="svg2"></svg>
        <script>
            async function init2() {
                // Reference: https://d3-graph-gallery.com/graph/barplot_horizontal.html
                // Reference: https://d3-graph-gallery.com/graph/interactivity_tooltip.html#template
                const data = await d3.csv("https://RyoTakaki.github.io/Learning_time.csv");
                console.log(data);
                var margin = { top: 50, right: 50, bottom: 150, left: 200 },
                    width = 1200 - margin.left - margin.right,
                    height = 800 - margin.top - margin.bottom;
                var xs = d3.scaleBand().domain(data.map(function (d) { return d.Course; })).range([0, width]).padding(.1);
                var ys = d3.scaleLinear().domain([0, 20]).range([height, 0]);

                var allGroup = [
                    "CS410 Text Information Systems",
                    "CS498 Internet of Things",
                    "CS598 Deep Learning for Healthcare",
                    "CS412 Introduction to Data Mining",
                    "CS598 Data Mining Capstone",
                    "CS598 Practical Statistical Learning",
                    "CS441 Applied Machine Learning",
                    "CS416 Data Visualization"
                ]
                // create a tooltip
                var Tooltip = d3.select("#page2")
                    .append("div")
                    .style("opacity", 0)
                    .attr("class", "tooltip")
                    .style("background-color", "white")
                    .style("border", "solid")
                    .style("border-width", "1px")
                    .style("border-radius", "5px")
                    .style("padding", "5px")

                // Three function that change the tooltip when user hover / move / leave a cell
                var mouseover = function (d) {
                    Tooltip
                        .style("opacity", 1)
                    d3.select(this)
                        .style("stroke", "grey")
                        .style("opacity", 1)
                }
                var mousemove = function (d) {
                    Tooltip
                        .html("Total study hours per week: " + d.Ave_time_week + " [hour]")
                        .style("position", "absolute")
                        .style("left", (d3.mouse(this)[0] + margin.left) + "px")
                        .style("top", (d3.mouse(this)[1] + margin.top + 50) + "px")
                }
                var mouseleave = function (d) {
                    Tooltip
                        .style("opacity", 0)
                    d3.select(this)
                        .style("stroke", "none")
                        .style("opacity", 0.8)
                }

                // A color scale: one color for each group
                var myColor = d3.scaleOrdinal()
                    .domain(allGroup)
                    .range(d3.schemeSet2);

                // Features of the annotation
                const annotations_max = [
                    {
                        note: {
                            label: "Here is the annotation label",
                            title: "MaxMaxMaxMaxMax"
                        },
                        color: ["#69b3a2"],
                        x: 382,
                        y: 160,
                        dx: 50,
                        dy: -80
                    }
                ]

                // Features of the annotation
                const annotations_min = [
                    {
                        note: {
                            label: "test",
                            title: "MinMinMinMinMin"
                        },
                        x: 1000,
                        y: 300,
                        dx: 50,
                        dy: 80
                    }
                ]
                // Add annotation to the chart
                const makeAnnotations_max = d3.annotation()
                    .annotations(annotations_max)

                const makeAnnotations_min = d3.annotation()
                    .annotations(annotations_min)

                d3.select("#svg2")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .selectAll()
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("x", function (d) { return xs(d.Course); })
                    .attr("y", function (d) { return ys(d.Ave_time_week); })
                    .attr("height", function (d) { return height - ys(d.Ave_time_week) })
                    .attr("width", xs.bandwidth())
                    .attr("fill", function(d){ return myColor(d.Course) })
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave);

                // Annotation
                d3.select("#svg2")
                    .append("g")
                    .call(makeAnnotations_max);

                // Annotation
                d3.select("#svg2")
                    .append("g")
                    .call(makeAnnotations_min);

                // Y axis
                d3.select("#svg2")
                    .append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .call(d3.axisLeft(ys));

                // X axis
                d3.select("#svg2")
                    .append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(" + margin.left + ", " + (height + margin.top) + ")")
                    .call(d3.axisBottom(xs))
                    .selectAll("text")
                    .attr("transform", "translate(-10, 0)rotate(-30)")
                    .style("text-anchor", "end");

                d3.select("#svg2")
                    .append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", -margin.top - height/2)
                    .attr("y", margin.left - 50)
                    .attr("transform", "rotate(-90)")
                    .text("Total study hours per week [hour]")
                    .style("font-family", "sans-serif")
                    .style("font-size", 20);
            }
        </script>
    </div>

    <div class="page" id="page3">
        <h1>Page 3</h1>
        <div>
            <button onclick="change_page(2)">Prev.</button>
            <!-- Initialize a select button -->
            <select id="selectButton"></select>
        </div>
        <svg id="svg3"></svg>
        <script>
            async function init3() {
                // Reference: https://d3-graph-gallery.com/graph/connectedscatter_legend.html
                // Reference: https://d3-graph-gallery.com/graph/line_filter.html
                const data = await d3.csv("https://RyoTakaki.github.io/Learning_time_week_time_per_course.csv");
                console.log(data);
                var margin = { top: 50, right: 50, bottom: 150, left: 200 },
                    width = 1200 - margin.left - margin.right,
                    height = 800 - margin.top - margin.bottom;

                var allGroup = [
                    "CS410 Text Information Systems",
                    "CS498 Internet of Things",
                    "CS598 Deep Learning for Healthcare",
                    "CS412 Introduction to Data Mining",
                    "CS598 Data Mining Capstone",
                    "CS598 Practical Statistical Learning",
                    "CS441 Applied Machine Learning",
                    "CS416 Data Visualization"
                ]

                // add the options to the button
                d3.select("#selectButton")
                    .selectAll('myOptions')
                    .data(allGroup)
                    .enter()
                    .append('option')
                    .text(function (d) { return d; }) // text showed in the menu
                    .attr("value", function (d) { return d; }) // corresponding value returned by the button

                // A color scale: one color for each group
                var myColor = d3.scaleOrdinal()
                    .domain(allGroup)
                    .range(d3.schemeSet2);

                var xs = d3.scaleLinear().domain([0, 18]).range([0, width]);
                var ys = d3.scaleLinear().domain([0, 50]).range([height, 0]);

                var svg = d3.select("#svg3")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                var line = svg
                    .append("g")
                    .append("path")
                    .datum(data.filter(function (d) { return d.Course == allGroup[0] }))
                    .attr("d", d3.line()
                        .x(function (d) { return xs(+d.Week) })
                        .y(function (d) { return ys(+d.TimePerWeek) })
                    )
                    .attr("stroke", function (d) { return myColor("CS410 Text Information Systems") })
                    .style("stroke-width", 4)
                    .style("fill", "none");

                // Y axis
                svg.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(ys));

                // X axis
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(xs).ticks(18));

                svg.append("text", id = "xaxis")
                    .attr("text-anchor", "middle")
                    .attr("x", width / 2)
                    .attr("y", height + 50)
                    .text("Week")
                    .style("font-family", "sans-serif")
                    .style("font-size", 20);

                svg.append("text", id = "yaxis")
                    .attr("text-anchor", "middle")
                    .attr("x", -height / 2)
                    .attr("y", -40)
                    .attr("transform", "rotate(-90)")
                    .text("Total study hours per week [hour]")
                    .style("font-family", "sans-serif")
                    .style("font-size", 20);

                // A function that update the chart
                function update(selectedGroup) {

                    // Create new data with the selection?
                    var dataFilter = data.filter(function (d) { return d.Course == selectedGroup })

                    // Give these new data to update line
                    line
                        .datum(dataFilter)
                        .transition()
                        .duration(1000)
                        .attr("d", d3.line()
                            .x(function (d) { return xs(+d.Week) })
                            .y(function (d) { return ys(+d.TimePerWeek) })
                        )
                        .attr("stroke", function (d) { return myColor(selectedGroup) })
                }

                // When the button is changed, run the updateChart function
                d3.select("#selectButton").on("change", function (d) {
                    // recover the option that has been chosen
                    var selectedOption = d3.select(this).property("value")
                    // run the updateChart function with this selected option
                    update(selectedOption)

                })

            }
        </script>
    </div>

    <!-- Reference: https://d3-graph-gallery.com/graph/custom_annotation.html -->
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <!-- Load d3-annotation -->
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

    <script>

        function change_page(page_num) {
            // Hide all pages
            d3.selectAll(".page").classed("active", false);

            // Only show the selected page
            d3.select("#page" + page_num).classed("active", true);
        }
    </script>
</body>

</html>